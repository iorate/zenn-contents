---
title: "TypeScript ã§ Chrome/Firefox ä¸¡å¯¾å¿œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ã"
emoji: "ğŸ•Œ"
type: "tech"
topics: ["chromeæ‹¡å¼µ", "typescript"]
published: true
---
# ã¯ã˜ã‚ã«

ã“ã‚Œã¯ TypeScript ã§ Chrome/Firefox ä¸¡å¯¾å¿œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ããŸã‚ã«ã€[è‡ªåˆ†ã®æ‹¡å¼µæ©Ÿèƒ½](https://github.com/iorate/uBlacklist) ã§å®Ÿè·µã—ã¦ã„ã‚‹/ã„ãŸã“ã¨ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ã§ã‚ã‚‹ã€‚ã™ãªã‚ã¡ã€JavaScript/CSS/HTML ã§æ§‹æˆã•ã‚Œã‚‹æ‹¡å¼µæ©Ÿèƒ½ã‚’ã€ã„ã‹ã«ã—ã¦å‹ã«å®ˆã‚‰ã‚ŒãŸ TypeScript ã®ä¸–ç•Œã§é–‹ç™ºã™ã‚‹ã‹ã€ã¾ãŸ Chrome/Firefox ã§ã„ã‹ã«ã‚³ãƒ¼ãƒ‰ã‚’å…±é€šåŒ–ã™ã‚‹ã‹ã€ãã®æ–¹æ³•ã®ä¸€ã¤ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã€‚
å¿…ãšã—ã‚‚æœ€é©è§£ã¨ã¯é™ã‚‰ãªã„ã—ã€ãã‚‚ãã‚‚ TypeScript åŒ–ãŒæ‰‹æ®µã§ãªãç›®çš„ã¨ãªã£ã¦ã„ã‚‹ã‚ˆã†ãªéƒ¨åˆ†ã‚‚ã‚ã‚‹ã€‚

# TypeScript

ã¾ãšæœ€æ–°ã® [TypeScript](https://github.com/microsoft/TypeScript) ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `tsconfig.json` ã‚’ä½œæˆã™ã‚‹ã€‚ä»¥ä¸‹ã¯ä¸€æ¡ˆã€‚

```json:tsconfig.json
{
  "compilerOptions": {
    "target": "ES2019",
    "module": "commonjs",
    "sourceMap": true,
    "strict": true,
    "noUncheckedIndexedAccess": true,
    "moduleResolution": "node",
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  }
}
```

æœ€è¿‘ã® Chrome ã‚„ Firefox ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ãªã‚‰ã€`"target": "ES2019"` ãã‚‰ã„ã¯è¦æ±‚ã—ã¦ã‚‚å¤§ä¸ˆå¤«ã‹ã€‚ä¸å®‰ãªã‚‰ä¸‹ã’ã¦ã‚‚ã‚ˆã„ã€‚
å‡ºåŠ›ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å½¢å¼ã¯ã€å¾Œã§ webpack ã§ãƒãƒ³ãƒ‰ãƒ«ã™ã‚‹ãŸã‚ `"module": "commonjs"` ã¨ `"module": "ES2015"` ã®ã©ã¡ã‚‰ã§ã‚‚ã‚ˆã„ã€‚webpack ã®è¨­å®šã‚’ TypeScript ã§æ›¸ããŸã‚ã« `"module": "commonjs"` ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ãªã®ã§ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ãŸããªã‘ã‚Œã° `"module": "commonjs"` ã§ã„ã„ã ã‚ã†ã€‚
TypeScript 4.1 ã§åŠ ã‚ã£ãŸ `"noUncheckedIndexedAccess": true` ã‚‚æ˜¯éå…¥ã‚Œã¦ãŠããŸã„ã€‚~~è‡ªåˆ†ã¯å…¥ã‚Œã¦ã„ãªã„ãŒ~~

# webpack

æ‹¡å¼µæ©Ÿèƒ½ã‚’é–‹ç™ºã™ã‚‹ã«ã‚ãŸã‚Šã€ãƒãƒ³ãƒ‰ãƒ©ã¯å¿…é ˆã¨ã¾ã§ã¯è¨€ãˆãªã„ãŒã‚ã‚‹æ–¹ãŒã‚ˆã„ã€‚Content scripts ã‹ã‚‰ã¯ ES modules ã‚’ä½¿ãˆãªã„ç‚¹ã€CommonJS å½¢å¼ã® npm ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã„ãŸã„ç‚¹ãŒä¸»ãªç†ç”±ã€‚å‰è€…ã¯ `<script type="module">` ã‚’å‹•çš„ã«æŒ¿å…¥ã™ã‚Œã°ã„ã„ã¨ã‹ã€workarounds ã¯ãªãã¯ãªã„ãŒã€ä½•ã‚‚è€ƒãˆãšã«ãƒãƒ³ãƒ‰ãƒ©ã« 1 ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¦ã‚‚ã‚‰ã£ãŸæ–¹ãŒæ¥½ã€‚è‰²ã€…ãªã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚‚ããã€‚

ã“ã“ã§ã¯é«˜æ©Ÿèƒ½ãª [webpack](https://github.com/webpack/webpack) ã‚’ä½¿ã†ã€‚ç¾åœ¨ (2021/1) ã®æœ€æ–°ç‰ˆã¯ 5ã€‚[ts-loader](https://github.com/TypeStrong/ts-loader) (ã‚ã‚‹ã„ã¯ [babel-loader](https://github.com/babel/babel-loader)) ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ TypeScript ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚
ã¾ãŸ TypeScript ã§æ›¸ãã¨è¨€ã£ãŸä»¥ä¸Šã€å½“ç„¶ webpack ã®è¨­å®šã‚‚ TypeScript ã§æ›¸ã ([å‚è€ƒ](https://webpack.js.org/configuration/configuration-languages/#typescript))ã€‚[ts-node](https://github.com/TypeStrong/ts-node) ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦ã€å¤šãã®å ´åˆ `@types/node` ã‚‚å¿…è¦ã€‚å‚è€ƒ URL ã§ã¯ `@types/webpack` ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã‚‹ãŒã€webpack 5 ã¯å‹å®šç¾©ã‚’å†…è”µã—ã¦ã„ã‚‹ã®ã§ä¸è¦ã€‚TypeScript ã®è¨­å®šã¯ `"module": "commonjs"` ã«ã—ã¦ãŠãã€‚

```typescript:webpack.config.ts
import webpack from 'webpack';

const config: webpack.Configuration = {
  module: {
    rules: [
      { test: /\.tsx?$/, use: 'ts-loader' },
    ],
  },
  // ...
};

export default config;
```

æ³¨æ„ã™ã¹ãã¯ã€ç¾æ™‚ç‚¹ (2021/1) ã§ã¯ä¸€éƒ¨ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒå‹å®šç¾©ã‚’ `@types/webpack` ã«ä¾å­˜ã—ã¦ã„ãŸã‚Šã€ç‹¬è‡ªã®å‹å®šç¾©ã‚’ä½¿ã£ã¦ã„ãŸã‚Šã—ã¦ã€webpack æœ¬ä½“ã¨å‹ãŒåˆã‚ãªã„å ´åˆãŒã‚ã‚‹ã“ã¨ã€‚å¼·å¼•ã«ã‚­ãƒ£ã‚¹ãƒˆã—ã¦å¯¾å‡¦ã™ã‚‹ã€‚

```typescript
const config: webpack.Configuration = {
  plugins: [
    (new SomePlugin() as unknown) as webpack.WebpackPluginInstance,
  ],
  // ...
};
```

ã•ã¦ Chrome ç”¨ã®ãƒ“ãƒ«ãƒ‰ã¨ Firefox ç”¨ã®ãƒ“ãƒ«ãƒ‰ã‚’ä½œã‚‹ã®ã ãŒã€webpack ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†ã‘ã‚‹ã“ã¨ã¯ã›ãšã€å¤–ã‹ã‚‰ãƒ–ãƒ©ã‚¦ã‚¶åã‚’å¤‰æ•°ã¨ã—ã¦ä¸ãˆã‚‹ã“ã¨ã«ã™ã‚‹ã€‚ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†æ–¹æ³•ã¨ webpack-cli ã®å¼•æ•°ã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚‹ãŒã€ã“ã“ã§ã¯å‰è€…ã‚’æ¡ç”¨ã™ã‚‹ã€‚

```json:package.json
{
  "scripts": {
    "build:chrome": "cross-env BROWSER=chrome webpack",
    "build:firefox": "cross-env BROWSER=firefox webpack"
  },
  // ...
}
```

```typescript:webpack.config.ts
const config: webpack.Configuration = {
  output: {
    path: path.join(__dirname, 'dist', process.env.BROWSER),
  },
  // ...
};
```

# æ‹¡å¼µæ©Ÿèƒ½ã® API

Chrome ã§ã¯ `chrome.*` ã®å½¢ã§ã€Firefox ã§ã¯ `browser.*` ã®å½¢ã§æ§˜ã€…ãªæ‹¡å¼µæ©Ÿèƒ½ã® API ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚ã‹ãªã‚Šäº’æ›æ€§ã¯é«˜ã„ã®ã ãŒã€å‰è€…ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã€å¾Œè€…ã¯ `Promise` ãƒ™ãƒ¼ã‚¹ã§ã‚ã‚Šã€é•ã„ã‚’å¸åã™ã‚‹å±¤ã‚’ã‹ã¾ã›ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

ç¾æ™‚ç‚¹ã§ã¯ã€ãŠãã‚‰ã [webextensions-polyfill-ts](https://github.com/Lusito/webextension-polyfill-ts) ãŒæœ€é©è§£ã§ã‚ã‚‹ã€‚~~è‡ªåˆ†ã¯ä½¿ã£ã¦ã„ãªã„ãŒ~~

```typescript
import { browser } from 'webextension-polyfill-ts';

async function doubleStorageValue(): Promise<void> {
  const value: number = await browser.storage.local.get('value');
  return browser.storage.local.set({ value: value * 2 });
}
```

ãªãŠã€Chrome ã§ã‚‚ Manifest V3 ã§ `Promise` ãƒ™ãƒ¼ã‚¹ã® API ãŒå®Ÿè£…ã•ã‚Œã¤ã¤ã‚ã‚‹ ([å‚è€ƒ](https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/#promises))ã€‚

# æ¡ä»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

API ã®å‘¼ã³å‡ºã—ã‚’å…±é€šåŒ–ã—ã¦ã‚‚ã€Chrome ã¨ Firefox ã§å‡¦ç†ã‚’åˆ†ã‘ãŸã„éƒ¨åˆ†ã¯å‡ºã¦ãã‚‹ã€‚ä¸€éƒ¨ã¯ [DefinePlugin](https://webpack.js.org/plugins/define-plugin/) ã‚ã‚‹ã„ã¯ [EnvironmentPlugin](https://webpack.js.org/plugins/environment-plugin/) ã§å¯¾å¿œå¯èƒ½ã§ã‚ã‚‹ã€‚EnvironmentPlugin ã®ä¾‹ã‚’ç¤ºã™ã€‚

```typescript:webpack.config.ts
const config: webpack.Configuration = {
  plugins: [
    new webpack.EnvironmentPlugin(['BROWSER']),
  ],
  // ...
};
```

æ‹¡å¼µæ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰

```typescript
if (process.env.BROWSER === 'chrome') {
  console.log('chrome');
} else {
  console.log('firefox');
}
```

ä¸Šè¨˜ã®å ´åˆã¯å•é¡Œãªã„ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã‚Šã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ†ã‘ãŸã„å ´åˆã€ã‚ã‚‹ã„ã¯ TypeScript ã®å‹å®šç¾©ã‚’åˆ†ã‘ãŸã„å ´åˆã«ã¯ã€`if` æ–‡ã§åˆ†ã‘ã‚‹ã“ã¨ã¯é›£ã—ã„ (å‰è€…ã¯ã‚ã‚‹ç¨‹åº¦ dynamic import ã§é€ƒã’ã‚‰ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ãŒ)ã€‚

ãã†ã„ã†å ´åˆã¯ã€[ifdef-loader](https://github.com/nippur72/ifdef-loader) ã‚’ä½¿ã†ã“ã¨ãŒã§ãã‚‹ã€‚

```typescript:webpack.config.ts
// ...
{
  test: /\.tsx?$/,
  use: [
    'ts-loader',
    {
      loader: 'ifdef-loader',
      options: {
        BROWSER: process.env.BROWSER,
      },
    },
  ],
},
// ...
```

æ‹¡å¼µæ©Ÿèƒ½ã®ã‚³ãƒ¼ãƒ‰

```typescript
/// #if BROWSER === 'chrome'
import { awesomeFunction } from './awesome-module-chrome';
/// #else
import { awesomeFunction } from './awesome-module-firefox';
/// #endif
```

ã“ã‚Œã¯ã‚³ãƒ¼ãƒ‰ã‹ã‚‰äºˆæƒ³ã•ã‚Œã‚‹é€šã‚Šã«å‹•ãã€‚

ã ãŒ VSCode ã§ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ãŸã‚‰ã€TypeScript ã® language server ã‹ eslint ã‚ãŸã‚Šã«æ€’ã‚‰ã‚Œã‚‹ã ã‚ã† (`awesomeFunction` ãŒé‡è¤‡ã—ã¦ã„ã‚‹)ã€‚ãã‚ŒãŒæˆ‘æ…¢ãªã‚‰ãªã„å ´åˆã¯ã€ifdef-loader ãŒ `/* ... */` å½¢å¼ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£ã—ãªã„ã“ã¨ã‚’åˆ©ç”¨ã—ã€æ¬¡ã®ã‚ˆã†ã«æ›¸ãã€‚

```typescript
/// #if BROWSER === 'chrome'
import { awesomeFunction } from './awesome-module-chrome';
/*
/// #else
import { awesomeFunction } from './awesome-module-firefox';
/// #endif
/// #if BROWSER === 'chrome'
*/
/// #endif
```

ã‚ã‚‹ã„ã¯è‡ªåˆ†ã§ [loader](https://github.com/iorate/if-webpack-loader) ã‚’æ›¸ã„ã¦ã—ã¾ã£ã¦ã‚‚ã‚ˆã„ã€‚Source map ãŒãšã‚Œãªã„ã‚ˆã†ãªå·¥å¤«ã¯è¦ã‚‹ã€‚

```typescript
// #if BROWSER === 'chrome'
import { awesomeFunction } from './awesome-module-chrome';
/* #else
import { awesomeFunction } from './awesome-module-firefox';
*/
// #endif
```

# JSON â†’ TypeScript

(ã“ã‚Œä»¥é™ã®ç¯€ã¯ã€TypeScript åŒ–ãŒç›®çš„ã¨åŒ–ã—ã¦ã„ã‚‹ç¯€ãŒã‚ã‚‹)

æ‹¡å¼µæ©Ÿèƒ½ã®é–‹ç™ºã§ã¯ã€å°‘ãªãã¨ã‚‚ 1 ã¤ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã€‚`manifest.json` ã§ã‚ã‚‹ã€‚ã“ã‚Œã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã‚Šæ›¸ãã¹ãé …ç›®ãŒå¾®å¦™ã«é•ã†ã€‚ã§ãã‚Œã° TypeScript åŒ–ã—ã¦ã€ä¸Šè¨˜ã®æ¡ä»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã®æ‰‹æ³•ã‚’ä½¿ã„ãŸã„ã€‚

ã¾ãŸã€å›½éš›åŒ–ã®ãŸã‚ã«ã¯ãƒ­ã‚±ãƒ¼ãƒ«ã”ã¨ã«ä»¥ä¸‹ã®ã‚ˆã†ãª `messages.json` ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ãŒã€å¤šæ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã‚ã‚‹çŠ¶æ…‹ã§ã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ã‚’ã—ãªã„ä¿è¨¼ã¯ãªãã€ã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ—ãƒŸã‚¹ãŒã‚ã£ã¦ã‚‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ã‚±ãƒ¼ãƒ«ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä»£ã‚ã‚Šã«ä½¿ã‚ã‚Œã‚‹ã ã‘ãªã®ã§æ°—ã¥ãã«ãã„ã€‚ã“ã“ã¯ TypeScript ã®å‹ã«å®ˆã£ã¦ã‚‚ã‚‰ã„ãŸã„ã€‚

```json:_locales/en/messages.json
{
  "extensionName": {
    "message": "hogepiyo",
  },
  "extensionDescription": {
    "message": "My excellent extension!",
  },
  // å¤šæ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç¶šã
}
```

JSON ã® TypeScript åŒ–ã®ãŸã‚ã€[val-loader](https://github.com/webpack-contrib/val-loader) ã¨ [file-loader](https://github.com/webpack-contrib/file-loader) ã‚’ä½¿ã†ã®ã¯ä¸€æ¡ˆã§ã‚ã‚‹ã€‚

```typescript:webpack.config.ts
const config: webpack.Configuration = {
  entries: {
    'manifest.json': './manifest.json.ts',
  },
  module: {
    rules: [
      {
        test: /\.json.ts$/,
        use: [
          {
            loader: 'file-loader',
            options: {
              name: '[path][name]',
            },
          },
          'val-loader',
          'ts-loader',
          {
            loader: 'ifdef-loader',
            options: {
              BROWSER: process.env.BROWSER,
            },
          },
        ],
      },
    ],
  },
  // ...
};
```

```typescript:manifest.json.ts
const manifest = {
  options_ui: {
    /// #if BROWSER === 'chrome'
    chrome_style: false,
    /// #else
    browser_style: false,
    /// #endif
    page: 'options.html',
  },
  // ...
};

export default () => ({
  cacheable: true,
  code: JSON.stringify(manifest, null, 2),
});
```

æ‚ªãã¯ãªã„ã€‚ã ãŒã€ã“ã®æ–¹æ³•ã«ã¯ `*.json.ts` ã‹ã‚‰ä»–ã® TypeScript ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ããªã„ã¨ã„ã†æ¬ ç‚¹ãŒã‚ã‚‹ (ç´°ã‹ã„èª¬æ˜ã¯çœã)ã€‚ã¾ãŸ `*.json.js` ã¨ã„ã†ã‚´ãƒŸå‡ºåŠ›ãŒæ®‹ã‚‹ ([webpack-fix-style-only-entries](https://github.com/fqborges/webpack-fix-style-only-entries) ã§æ¶ˆã™ã“ã¨ã¯å¯èƒ½)ã€‚

è‡ªå‰ã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ãã“ã¨ãŒæœ€çµ‚çš„ãªè§£æ±ºã¨ãªã‚‹ã€‚å¤§ã–ã£ã±ã«è¨€ã†ã¨ã€`*.json.ts` ã¯é€šå¸¸é€šã‚Š webpack ã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«â†’ãƒãƒ³ãƒ‰ãƒ«ã—ã¦ã‚‚ã‚‰ã„ã€ãã®å¾Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ `eval()` â†’ `JSON.stringify()` ã—ã¦ã€å‡ºåŠ›ã‚’ã™ã’æ›¿ãˆã‚‹ã€‚

```typescript:webpack.config.ts
const config: webpack.Configuration = {
  entry: {
    'manifest.json': './manifest.json.ts',
  },
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: [
          'ts-loader',
          {
            loader: 'ifdef-loader',
            options: {
              BROWSER: process.env.BROWSER,
            },
          },
        ],
      },
    ],
  },
  plugins: [
    {
      apply(compiler: webpack.Compiler): void {
        compiler.hooks.compilation.tap('JsonPlugin', compilation => {
          compilation.hooks.processAssets.tap(
            {
              name: 'JsonPlugin',
              stage: webpack.Compilation.PROCESS_ASSETS_STAGE_PRE_PROCESS,
            },
            assets => {
              for (const [name, source] of Object.entries(assets)) {
                if (name.endsWith('.json.js')) {
                  delete assets[name];
                  let exportAsJSON = {};
                  eval(source.source().toString());
                  assets[name.slice(0, -3)] = new webpack.sources.RawSource(
                    JSON.stringify(exportAsJSON, null, 2),
                  );
                }
              }
            },
          );
        });
      },
    },
  ],
  // ...
}
```

```typescript:manifest.json.ts
exportAsJSON = {
  options_ui: {
    /// #if BROWSER === 'chrome'
    chrome_style: false,
    /// #else
    browser_style: false,
    /// #endif
    page: 'options.html',
  },
  // ...
};
```

å‡ºåŠ›

```json:dist/chrome/manifest.json
{
  "options_ui": {
    "chrome_style": false,
    "page": "options.html"
  },
  // ...
}
```

```json:dist/firefox/manifest.json
{
  "options_ui": {
    "browser_style": false,
    "page": "options.html"
  },
  // ...
}
```

# HTML â†’ TypeScript

æ‹¡å¼µæ©Ÿèƒ½ã®é–‹ç™ºã§ã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ç”»é¢ã‚„ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ä½œã‚‹ã®ã« HTML ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã€‚ã ãŒ [React](https://github.com/facebook/react) ã®ã‚ˆã†ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã§ã€ãã‚Œã‚‰ã®å¤§éƒ¨åˆ†ã‚’ TypeScript (TSX) ã«ç§»ã™ã“ã¨ãŒã§ãã€ã¾ãŸä»®æƒ³ DOM ãªã©ã®æ©æµã‚’å—ã‘ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã€‚å€‹äººçš„ã«ã¯ã€[Preact](https://github.com/preactjs/preact) ãŒå°ã•ãèª­ã¿ã‚„ã™ã„ã®ã§å‹§ã‚ãŸã„ã€‚

```typescript:options.tsx
const Options: FunctionComponent = () => {
  return (
    // ...
  );
);

render(<Options />, document.body);
```

```html:options.html
<html>
  <head>
    <meta charset="utf-8">
    <title>Options</title>
    <script defer src="./options.js"></script>
  </head>
  <body></body>
</html>
```

ã“ã†ãªã‚‹ã¨ HTML ãƒ•ã‚¡ã‚¤ãƒ«ã¯å®Ÿè³ªç©ºã£ã½ã§ã‚ã‚‹ã€‚[HTMLWebpackPlugin](https://github.com/jantimon/html-webpack-plugin) ã§ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ã™ã‚Œã°ã‚½ãƒ¼ã‚¹ã‹ã‚‰ HTML ã¯æ¶ˆæ»…ã™ã‚‹ã€‚

```typescript:webpack.config.ts
const config: webpack.Configuration = {
  entry: {
    options: './options.tsx',
    popup: './popup.tsx',
  },
  plugins: [
    new HtmlWebpackPlugin({
      chunks: ['options'],
      filename: 'options.html',
      title: 'Options',
    }),
    new HtmlWebpackPlugin({
      chunks: ['popup'],
      filename: 'popup.html',
      title: 'Popup',
    }),
  ],
  // ...
};
```

ãªãŠç¾æ™‚ç‚¹ (2021/1) ã§ã¯ã€HTMLWebpackPlugin ã‚’ webpack 5 ã¨å…±ã«ä½¿ã†ã«ã¯ã€`html-webpack-plugin@next` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

# CSS â†’ TypeScript

[styled-components](https://github.com/styled-components/styled-components) ãªã©ã® CSS-in-JS ã‚’å®Ÿç¾ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã§ã€CSS ã‚‚ TypeScript ã«ç§»ã™ã“ã¨ãŒå¯èƒ½ã§ã‚ã‚‹ã€‚ãã‚Œã«ã‚ˆã‚Šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ãŒ 1 ã‚«æ‰€ã«é›†ã¾ã‚Šã€æ‰±ã„ã‚„ã™ããªã‚‹ã€‚VSCode ã¨ stylelint ã®ã‚µãƒãƒ¼ãƒˆã‚‚æ‚ªããªã„ã€‚

å€‹äººçš„ã«ã¯ [goober](https://github.com/cristianbote/goober) ãŒå°ã•ãã¦å¥½ãã ãŒã€Firefox ã® content scripts ã§ä½¿ã†ã¨ `<style>` è¦ç´ ãŒå¢—æ®–ã™ã‚‹ã¨ã„ã†åˆ†ã‹ã‚Šã«ãã„å•é¡ŒãŒã‚ã‚‹ã€‚è§£æ±ºç­–ã ã‘æ›¸ãã¨ã€ä»¥ä¸‹ã§ã‚ã‚‹ã€‚

```typescript
import * as goober from 'goober';

const css = goober.css.bind({ target: document.head });
const glob = goober.css.bind({ g: 1, target: document.head });
const styled = goober.styled.bind({ target: document.head });
```

# ãŠã‚ã‚Šã«
TypeScript ã§ Chrome/Firefox ä¸¡å¯¾å¿œã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ãæ–¹æ³•ã®ä¸€ã¤ã‚’ã¾ã¨ã‚ãŸã€‚
